<html manifest="84ciss.manifest"><head>
<title>Auto Cache(FW 9.00)</title>
<script>history.replaceState(null,null,'index.html');</script>
</head>
<style>
body {
    font-family: system-ui;
    text-align: center;
    background-color: #111112;
    color: white;
}
h1 {
    color: #fff;
    font-size: 46px;
    font-weight: bold;
    text-shadow: 3px 2px #3d3939;
}
#progress {
    font-size: 35px;
    font-weight: bold;
    text-shadow: 3px 2px #3d3939;
    color: #fff;
}
#progress2 {
    font-size: 28px;
    font-weight: bold;
    color: #87FF33;
    text-shadow: 3px 2px #3d3939;
    margin-top: 20px;
    display: none;
}
.ready {
    color: #87FF33;
}
</style>
<body>
<br><br><br>
<h1><i>PS4 Jailbreak v2.0 (Fw 9.00)</i></h1>
<br><br><br><br>
<div id="progress">
    Caching files, please wait...
</div>
<div id="progress2">
    Caching Update files, please wait...
</div>
<br><br><br><br><br><br>
<div style="background-color:#032140;color:white;position:fixed;left:0;bottom:-0px;width:100%;text-align:center;">
<font style='color:#87FF33'>Modder & Dev : </font><a href="https://twitter.com/84Ciss" style='font-size:20px;text-align:center;color:yellow;'>@84Ciss</a> - Find Me In Tweeter if you have any kind of issues !&nbsp;
<br><font style='color:#87FF33'>Special thanks : </font>*Many Many Thanks to all Contributors in PS4 Scene ∆❍X❑*<br>
</div>

<script>
    var progress = document.getElementById('progress');
    var progress2 = document.getElementById('progress2');
    var redirected = false;
    
    // Détecter si c'est un UPDATE (venant de index.html avec manifest)
    var isUpdate = (document.referrer && document.referrer.indexOf('index.html') !== -1);
    
    // Si c'est un update, afficher le message spécial
    if (isUpdate) {
        progress.style.display = 'none';
        progress2.style.display = 'block';
        console.log('[Cache] Mode UPDATE détecté');
    } else {
        console.log('[Cache] Mode PREMIER CACHE détecté');
    }
    
    // Afficher le status du cache
    console.log('[Cache] Status: ' + window.applicationCache.status);
    console.log('[Cache] 0=UNCACHED, 1=IDLE, 2=CHECKING, 3=DOWNLOADING, 4=UPDATEREADY, 5=OBSOLETE');
    
    function redirectToIndex() {
        if (redirected) return;
        redirected = true;
        console.log('[Cache] Redirection vers index.html');
        localStorage.setItem("ps4_cached", "true");
        window.location.replace("index.html");
    }
    
    // TIMEOUT DE SÉCURITÉ - rediriger après 10 secondes quoi qu'il arrive
    var safetyTimeout = setTimeout(function() {
        console.log('[Cache] TIMEOUT - Redirection forcée après 10 secondes');
        if (isUpdate) {
            progress2.innerHTML = '<span style="color:#FFD700">Timeout! Redirecting...</span>';
        } else {
            progress.innerHTML = '<span style="color:#FFD700">Timeout! Redirecting...</span>';
        }
        setTimeout(redirectToIndex, 500);
    }, 10000);
    
    // Événement quand les fichiers sont mis en cache pour la première fois
    window.applicationCache.addEventListener('cached', function() {
        console.log('[Cache] Event: cached');
        clearTimeout(safetyTimeout);
        if (isUpdate) {
            progress2.innerHTML = '<span class="ready">Update complete! Redirecting...</span>';
        } else {
            progress.innerHTML = '<span class="ready">Cache complete! Redirecting...</span>';
        }
        setTimeout(redirectToIndex, 800);
    }, false);
    
    // Événement quand le cache est mis à jour
    window.applicationCache.addEventListener('updateready', function() {
        console.log('[Cache] Event: updateready');
        clearTimeout(safetyTimeout);
        if (isUpdate) {
            progress2.innerHTML = '<span class="ready">Update ready! Redirecting...</span>';
        } else {
            progress.innerHTML = '<span class="ready">Cache updated! Redirecting...</span>';
        }
        setTimeout(redirectToIndex, 800);
    }, false);
    
    // Événement de progression
    window.applicationCache.addEventListener('progress', function(e) {
        console.log('[Cache] Progress: ' + e.loaded + '/' + e.total);
    }, false);
    
    // Événement checking
    window.applicationCache.addEventListener('checking', function() {
        console.log('[Cache] Event: checking manifest');
    }, false);
    
    // Événement downloading
    window.applicationCache.addEventListener('downloading', function() {
        console.log('[Cache] Event: downloading files');
    }, false);
    
    // Événement noupdate
    window.applicationCache.addEventListener('noupdate', function() {
        console.log('[Cache] Event: noupdate - manifest unchanged');
        clearTimeout(safetyTimeout);
        if (isUpdate) {
            progress2.innerHTML = '<span class="ready">No update needed! Redirecting...</span>';
        } else {
            progress.innerHTML = '<span class="ready">Already up to date! Redirecting...</span>';
        }
        setTimeout(redirectToIndex, 500);
    }, false);
    
    // Si déjà en cache (IDLE ou UPDATEREADY), rediriger immédiatement
    if (window.applicationCache.status == 1 || window.applicationCache.status == 4) {
        console.log('[Cache] Already cached (status=' + window.applicationCache.status + ')');
        clearTimeout(safetyTimeout);
        if (isUpdate) {
            progress2.innerHTML = '<span class="ready">Already cached! Redirecting...</span>';
        } else {
            progress.innerHTML = '<span class="ready">Already cached! Redirecting...</span>';
        }
        setTimeout(redirectToIndex, 300);
    }
    
    // Gestion des erreurs de cache
    window.applicationCache.addEventListener('error', function(e) {
        console.log('[Cache] Event: ERROR');
        console.log(e);
        clearTimeout(safetyTimeout);
        if (isUpdate) {
            progress2.innerHTML = '<span style="color:#ee596f">Cache error! Redirecting anyway...</span>';
        } else {
            progress.innerHTML = '<span style="color:#ee596f">Cache error! Redirecting anyway...</span>';
        }
        setTimeout(redirectToIndex, 1500);
    }, false);
</script>
<script type="text/javascript">
 if(localStorage.getItem("theme")==null){
   localStorage.setItem("theme","2.jpg")
 }
 document.body.style.background = "url('"+localStorage.getItem("theme")+"')"
 document.body.style.backgroundSize = "cover"
 var imgs = ["1.jpg","2.jpg","3.jpg","4.jpg","5.jpg"];
 render()
 function render(){
     document.querySelector(".themes").innerHTML=""
	 for(let i=0;i<imgs.length;i++){
	    var selectText = "Select"
	    var textColor = "white"
	    if(localStorage.theme==imgs[i]){
	      selectText="Selected"
	      textColor="green"
	    }
	 	document.querySelector(".themes").innerHTML+='<div class="theme" ><img src="'+imgs[i]+'" ><span style="color:'+textColor+';" onclick="set('+i+')">'+selectText+'</span></div>';
	 }
 }
 function set(i){
    localStorage.setItem("theme",imgs[i])
    render()
 	document.body.style.background = "url('"+imgs[i]+"')"
 	document.body.style.backgroundSize = "cover"
 }
</script>
</body>
</html>
